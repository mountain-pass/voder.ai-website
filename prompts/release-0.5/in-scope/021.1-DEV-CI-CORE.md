# DEV-CI-CORE: Core CI/CD Quality Pipeline

## Release Goal

_"Release 0.5: Problem Validation - Establish core automated quality gates"_

Implement the main GitHub Actions CI workflow that validates code quality, runs tests, and performs builds for every commit and pull request, providing immediate feedback on code readiness and preventing quality issues from reaching the main branch.

## How This Story Contributes

This story establishes the foundation of automated quality assurance by implementing the primary CI workflow that catches coding errors, style violations, and test failures immediately. It enables rapid development cycles while maintaining code quality standards essential for founder validation sessions.

## User Story

So that I can get immediate feedback on code quality and prevent basic errors from reaching the main branch, as a developer, I want a core CI workflow that automatically runs TypeScript compilation, linting, formatting checks, tests, and builds on every commit and pull request.

**INVEST Criteria Compliance**:

- **Independent**: Can be implemented as a single workflow without other CI workflows
- **Negotiable**: Quality check combinations and triggers can be refined
- **Valuable**: Provides immediate feedback and prevents basic quality issues
- **Estimable**: Clear scope of single workflow with defined quality checks
- **Small**: Single ci.yml workflow focused on core quality validation
- **Testable**: Success measured by workflow execution and quality gate effectiveness

## Acceptance Criteria

- [ ] **Main CI Workflow**: Single ci.yml workflow runs on push to main and pull requests
- [ ] **Quality Validation**: Automated checks for TypeScript, ESLint, Prettier, unit tests
- [ ] **Build Verification**: Production build validation succeeds before merge
- [ ] **Parallel Execution**: Quality checks run in parallel for faster feedback
- [ ] **Status Reporting**: Clear GitHub status indicators for each check with CLI verification using `gh run list` and `gh run view`
- [ ] **Artifact Management**: Coverage reports and test results preserved
- [ ] **Failure Diagnostics**: Clear error messages when checks fail
- [ ] **Cache Optimization**: Dependencies cached for faster execution

## Requirements

### Core Quality Pipeline

- **REQ-WORKFLOW-TRIGGERS**: Workflow triggers on push to main and pull request events
- **REQ-QUALITY-CHECKS**: Automated validation of:
  - TypeScript compilation (`npm run type-check`)
  - ESLint rules (`npm run lint:check`)
  - Prettier formatting (`npm run format:check`)
  - Unit test execution (`npm run test:ci`)
  - Production build (`npm run build`)

### Performance and Reliability

- **REQ-PARALLEL-JOBS**: Multiple validation jobs run in parallel for speed
- **REQ-CACHE-DEPS**: Node.js dependencies cached for faster runs
- **REQ-CACHE-BROWSERS**: Playwright browsers cached when E2E tests run
- **REQ-TIMEOUT-HANDLING**: Appropriate timeouts for each validation step

### Reporting and Artifacts

- **REQ-STATUS-CHECKS**: GitHub status checks for each validation component
- **REQ-COVERAGE-REPORTS**: Unit test coverage reports uploaded as artifacts
- **REQ-BUILD-LOGS**: Build and test logs preserved for debugging
- **REQ-FAILURE-DETAILS**: Clear error output when validation fails

### Integration Requirements

- **REQ-NPM-SCRIPTS**: Integration with existing npm scripts in package.json
- **REQ-NODE-VERSION**: Consistent Node.js version (22.17.0) across CI
- **REQ-CLI-ASSESSMENT**: Workflow status verifiable via `gh run list` and `gh run view`

## Implementation Details

### Workflow Structure (ci.yml)

```yaml
name: CI & Playwright multi-browser tests
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  quality-checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '22.17.0'
          cache: 'npm'
      - run: npm ci
      - run: npm run type-check
      - run: npm run lint:check
      - run: npm run format:check
      - run: npm run test:ci
      - run: npm run build
```

### Artifact Management

- Coverage reports uploaded for code coverage tracking
- Test results preserved for debugging failed runs
- Build logs captured for troubleshooting build issues

## Dependencies

- 002.0-DEV-ENV-NODE (requires Node.js environment)
- 005.0-DEV-BUILD-VITE (requires build system)
- 010.0-DEV-LINT-JS (requires linting configuration)
- 011.0-DEV-TEST-UNIT (requires test framework)

## Success Metrics

- **100% workflow reliability** - workflow completes successfully for valid code
- **Sub-3-minute execution** - core quality checks complete within 3 minutes
- **Zero false positives** - workflow only fails for actual quality issues
- **Clear feedback** - failure reasons immediately apparent to developers
- **Cache efficiency** - 80%+ cache hit rate for dependencies
