# DEV-CI-CORE: Fast Feedback Quality Pipeline

## Release Goal

_"Release 0.5: Problem Validation - Establish fast automated quality gates"_

Implement the main GitHub Actions CI workflow that provides rapid feedback on basic code quality, TypeScript compilation, linting, formatting, and unit tests for every commit and pull request. This workflow prioritizes speed (5-10 minutes) to enable fast development cycles while catching common issues early.

## How This Story Contributes

This story establishes the foundation of rapid quality feedback by implementing a fast CI workflow that catches coding errors, style violations, and unit test failures within minutes. It enables rapid development cycles with immediate feedback, while comprehensive validation is handled by separate workflows.

## User Story

So that I can get immediate feedback on basic code quality and prevent common errors from reaching the main branch, as a developer, I want a fast CI workflow (5-10 minutes) that automatically runs TypeScript compilation, linting, formatting checks, and unit tests on every commit and pull request.

**INVEST Criteria Compliance**:

- **Independent**: ✅ Can be implemented as a single workflow without dependencies on other CI workflows
- **Negotiable**: ✅ Quality check combinations, timing thresholds, and failure criteria can be refined
- **Valuable**: ✅ Provides immediate feedback (5-10 min) and prevents basic quality issues from blocking development
- **Estimable**: ✅ Clear scope of single fast-feedback workflow with well-defined quality checks. Estimated 1 sprint
- **Small**: ✅ APPROPRIATELY SIZED - Single workflow with parallel execution of standard quality checks (TypeScript, ESLint, Prettier, unit tests)
- **Testable**: ✅ Success measured by workflow execution speed, quality gate effectiveness, and artifact generation for downstream workflows

## Acceptance Criteria

- [ ] **Fast CI Workflow**: Single ci-core.yml workflow optimized for speed (target: 5-10 minutes)
- [ ] **Basic Quality Validation**: Automated checks for TypeScript, ESLint, Prettier, unit tests only
- [ ] **Build Validation**: Basic build validation (not full production build)
- [ ] **Parallel Execution**: Quality checks run in parallel for faster feedback
- [ ] **Status Reporting**: Clear GitHub status indicators for each check with CLI verification using `gh run list` and `gh run view`
- [ ] **Artifact Management**: Unit test results and basic coverage reports preserved
- [ ] **Failure Diagnostics**: Clear error messages when basic checks fail
- [ ] **Cache Optimization**: Dependencies cached for faster execution
- [ ] **Fast Feedback Priority**: Workflow completes basic validation quickly, deferring comprehensive checks to other workflows

## Requirements

### Core Quality Pipeline

- **REQ-WORKFLOW-TRIGGERS**: Workflow triggers on push to main and pull request events
- **REQ-FAST-QUALITY-CHECKS**: Rapid validation of:
  - TypeScript compilation (`npm run type-check`)
  - ESLint rules (`npm run lint:check`)
  - Prettier formatting (`npm run format:check`)
  - Unit test execution (`npm run test:ci`)
  - Basic build validation (`npm run build:check` - lightweight validation, not full production build)
- **REQ-SPEED-OPTIMIZATION**: Target workflow completion in 5-10 minutes
- **REQ-PARALLEL-EXECUTION**: Run checks in parallel where possible
- **REQ-EARLY-FAILURE**: Fail fast on TypeScript or linting errors

### Performance and Reliability

- **REQ-PARALLEL-EXECUTION**: Run TypeScript, ESLint, Prettier, and unit tests in parallel
- **REQ-CACHE-OPTIMIZATION**: Cache Node.js dependencies and TypeScript compilation
- **REQ-FAST-FAILURE**: Fail immediately on TypeScript compilation errors
- **REQ-BASIC-BUILD-ARTIFACT**: Generate lightweight build artifact for use by comprehensive validation workflow
- **REQ-ARTIFACT-SHARING**: Share basic build validation results with downstream workflows to avoid redundant compilation

- **REQ-PARALLEL-JOBS**: Multiple validation jobs run in parallel for speed
- **REQ-CACHE-DEPS**: Node.js dependencies cached for faster runs
- **REQ-CACHE-BROWSERS**: Playwright browsers cached when E2E tests run
- **REQ-TIMEOUT-HANDLING**: Appropriate timeouts for each validation step

### Reporting and Artifacts

- **REQ-STATUS-CHECKS**: GitHub status checks for each validation component
- **REQ-COVERAGE-REPORTS**: Unit test coverage reports uploaded as artifacts
- **REQ-BUILD-LOGS**: Build and test logs preserved for debugging
- **REQ-FAILURE-DETAILS**: Clear error output when validation fails

### Integration Requirements

- **REQ-NPM-SCRIPTS**: Integration with existing npm scripts in package.json
- **REQ-NODE-VERSION**: Consistent Node.js version (22.17.0) across CI
- **REQ-CLI-ASSESSMENT**: Workflow status verifiable via `gh run list` and `gh run view`

## Implementation Details

### Workflow Structure (ci.yml)

```yaml
name: CI & Playwright multi-browser tests
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  quality-checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '22.17.0'
          cache: 'npm'
      - run: npm ci
      - run: npm run type-check
      - run: npm run lint:check
      - run: npm run format:check
      - run: npm run test:ci
      - run: npm run build
```

### Artifact Management

- Coverage reports uploaded for code coverage tracking
- Test results preserved for debugging failed runs
- Build logs captured for troubleshooting build issues

## Dependencies

- 002.0-DEV-ENV-NODE (requires Node.js environment)
- 005.0-DEV-BUILD-VITE (requires build system)
- 010.0-DEV-LINT-JS (requires linting configuration)
- 011.0-DEV-TEST-UNIT (requires test framework)

## Success Metrics

- **100% workflow reliability** - workflow completes successfully for valid code
- **Sub-3-minute execution** - core quality checks complete within 3 minutes
- **Zero false positives** - workflow only fails for actual quality issues
- **Clear feedback** - failure reasons immediately apparent to developers
- **Cache efficiency** - 80%+ cache hit rate for dependencies
