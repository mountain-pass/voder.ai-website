# DEV-CI-BUILD: Production Build Validation Pipeline

## Release Goal

_"Release 0.5: Problem Validation - Ensure production build readiness validation"_

Implement GitHub Actions production build validation workflow that performs comprehensive production builds, build artifact management, and deployment readiness verification. This workflow runs after fast feedback (021.1-DEV-CI-CORE) and provides production build validation.

## How This Story Contributes

This story ensures production deployment readiness by implementing a specialized build validation workflow that creates production-ready artifacts, validates build process, and prepares deployment readiness. It provides essential build quality gates before E2E testing and deployment authorization.

## User Story

So that I can be confident my code builds correctly for production and deployment artifacts are ready, as a developer, I want a production build validation workflow that creates optimized production builds, validates build process, and performs deployment readiness checks after fast feedback checks pass.

**INVEST Criteria Compliance**:

- **Independent**: ❌ DEPENDENT - Requires 021.1-DEV-CI-CORE fast feedback workflow to complete first
- **Negotiable**: ✅ Build optimization, artifact management, and deployment checks can be refined
- **Valuable**: ✅ Ensures production builds work correctly and deployment artifacts are ready
- **Estimable**: ✅ Clear scope focused on production build process and deployment readiness. Estimated 1 sprint
- **Small**: ✅ APPROPRIATELY SIZED - Single concern focused on production build validation and artifact management
- **Testable**: ✅ Success measured by successful production builds, artifact generation, and deployment readiness validation

## Acceptance Criteria

- [ ] **Production Build Workflow**: ci-build.yml workflow runs after fast feedback CI success
- [ ] **Production Build**: Full production build validation (`npm run build`)
- [ ] **Deploy Readiness Check**: Comprehensive deployment readiness validation (`npm run deploy:check`)
- [ ] **Build Artifact Preservation**: Production build artifacts preserved for downstream workflows
- [ ] **Artifact Optimization**: Reuse basic build artifacts from 021.1-DEV-CI-CORE when available
- [ ] **Performance Validation**: Basic build size and performance checks
- [ ] **Workflow Dependencies**: Only runs after 021.1-DEV-CI-CORE passes
- [ ] **Status Reporting**: Clear GitHub status for build validation
- [ ] **Cache Optimization**: Cache dependencies and build outputs for faster execution

## Requirements

### Build Process and Optimization

- **REQ-ARTIFACT-REUSE**: Download and reuse basic build artifacts from 021.1-DEV-CI-CORE when available
- **REQ-PRODUCTION-BUILD**: Full production build only if basic build artifacts not available or insufficient
- **REQ-BUILD-ARTIFACT-PRESERVATION**: Preserve production build artifacts for downstream workflows (E2E, deployment)
- **REQ-CACHE-OPTIMIZATION**: Cache dependencies and build outputs for faster execution
- **REQ-BUILD-VALIDATION**: Validate build process completes without errors

### Deployment Readiness

- **REQ-DEPLOY-CHECK**: Comprehensive deployment readiness validation (`npm run deploy:check`)
- **REQ-DEPLOYMENT-LOGS**: Capture deployment validation logs for debugging
- **REQ-PERFORMANCE-CHECKS**: Basic performance validation of built application
- **REQ-BUILD-SIZE-VALIDATION**: Monitor and validate build artifact sizes

### Workflow Integration

- **REQ-WORKFLOW-DEPENDENCY**: Only runs after 021.1-DEV-CI-CORE workflow succeeds
- **REQ-WORKFLOW-TRIGGERS**: Trigger on push to main and pull requests
- **REQ-DEPENDENCY-CACHING**: Cache dependencies for faster execution
- **REQ-CLI-ASSESSMENT**: Build status verifiable via `gh run list` and `gh run view`

## Dependencies

- 021.1-DEV-CI-CORE (requires fast feedback workflow to complete for artifact reuse and dependency management)

## Implementation Notes

### Workflow Structure (ci-build.yml)

```yaml
name: Production Build Validation
on:
  workflow_run:
    workflows: ['Fast Feedback CI']
    types: [completed]
    branches: [main]

jobs:
  production-build:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      # Download artifacts from fast feedback workflow
      - name: Download build artifacts
        uses: actions/download-artifact@v4
        with:
          name: build-artifacts
          path: dist/
        continue-on-error: true

      # Full production build if artifacts not available
      - name: Install dependencies
        run: npm ci

      - name: Production build
        run: npm run build

      # Deployment readiness validation
      - name: Deployment readiness check
        run: npm run deploy:check

      # Preserve artifacts for downstream workflows
      - name: Upload production artifacts
        uses: actions/upload-artifact@v4
        with:
          name: production-build
          path: dist/
          retention-days: 1
```

### Integration Points

- **Input**: Build artifacts from 021.1-DEV-CI-CORE (when available)
- **Output**: Production build artifacts for 021.4-DEV-E2E-TESTING and 021.5-DEV-VISUAL-REGRESSION
- **Triggers**: 021.4 and 021.5 workflows after this workflow succeeds
