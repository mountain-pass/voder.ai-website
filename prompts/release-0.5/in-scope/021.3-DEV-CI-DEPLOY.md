# DEV-CI-DEPLOY: Deployment Readiness Pipeline

## Release Goal

_"Release 0.5: Problem Validation - Ensure deployment readiness validation"_

Implement GitHub Actions deployment readiness workflow that validates production builds, runs comprehensive verification pipelines, and performs screenshot testing before code can be considered ready for deployment, ensuring only deployment-ready code reaches the main branch.

## How This Story Contributes

This story ensures deployment reliability by implementing a comprehensive validation workflow that verifies production builds, runs full verification suites, and validates visual consistency. It provides the final quality gate before deployment, ensuring founders only see polished validation experiences.

## User Story

So that I can be confident code is ready for production deployment, as a developer, I want a deployment readiness workflow that runs comprehensive verification checks, validates production builds, and performs screenshot testing to ensure the site works correctly before deployment.

**INVEST Criteria Compliance**:

- **Independent**: Can be implemented as standalone deployment validation workflow
- **Negotiable**: Verification steps and screenshot validation can be refined
- **Valuable**: Prevents broken deployments and ensures visual consistency
- **Estimable**: Clear scope of single deployment validation workflow
- **Small**: Single deploy.yml workflow focused on deployment readiness
- **Testable**: Success measured by deployment validation and screenshot consistency

## Acceptance Criteria

- [ ] **Deployment Workflow**: Single deploy.yml workflow validates deployment readiness
- [ ] **Full Verification**: Runs complete verification pipeline including all quality checks
- [ ] **Screenshot Testing**: Automated visual regression testing with Playwright
- [ ] **Production Build**: Validates production build completes successfully
- [ ] **Deployment Artifacts**: Generates and preserves production build artifacts
- [ ] **Visual Validation**: Ensures UI consistency across different viewports
- [ ] **Performance Validation**: Basic performance checks on built application
- [ ] **Status Reporting**: Clear GitHub status for deployment readiness

## Requirements

### Deployment Validation Pipeline

- **REQ-FULL-VERIFICATION**: Run complete verification pipeline (`npm run verify`)
- **REQ-SCREENSHOT-TESTING**: Execute visual regression tests (`npm run screenshots`)
- **REQ-PRODUCTION-BUILD**: Validate production build process (`npm run build`)
- **REQ-DEPLOY-CHECK**: Run deployment readiness validation (`npm run deploy:check`)

### Visual and Performance Validation

- **REQ-VISUAL-REGRESSION**: Screenshot comparison across different viewports
- **REQ-CROSS-BROWSER**: Validation across multiple browser engines
- **REQ-PERFORMANCE-CHECK**: Basic performance validation on built application
- **REQ-ACCESSIBILITY-BASIC**: Basic accessibility validation in deployment context

### Artifact Management

- **REQ-BUILD-ARTIFACTS**: Preserve production build artifacts for deployment
- **REQ-SCREENSHOT-ARTIFACTS**: Store screenshot comparison results
- **REQ-DEPLOYMENT-LOGS**: Capture deployment validation logs for debugging
- **REQ-PERFORMANCE-REPORTS**: Generate and store basic performance reports

### Integration and Reliability

- **REQ-WORKFLOW-TRIGGERS**: Trigger on push to main and pull requests
- **REQ-DEPENDENCY-CACHING**: Cache dependencies for faster execution
- **REQ-BROWSER-CACHING**: Cache Playwright browsers for screenshot testing
- **REQ-CLI-ASSESSMENT**: Deployment status verifiable via `gh run list` and `gh run view`

## Implementation Details

### Workflow Structure (deploy.yml)

```yaml
name: Deploy to Production
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deployment-readiness:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '22.17.0'
          cache: 'npm'
      - run: npm ci
      - run: npm run verify
      - run: npm run screenshots
      - run: npm run build
      - run: npm run deploy:check
```

### Verification Pipeline Integration

- Leverages existing npm scripts for verification
- Integrates with project's deployment validation scripts
- Connects with screenshot testing infrastructure

### Artifact Strategy

- Upload production build for deployment systems
- Preserve screenshot comparison results
- Store deployment validation reports

## Dependencies

- 021.1-DEV-CI-CORE (requires core CI pipeline for basic validation)
- 012.3-DEV-E2E-TESTING (requires E2E testing framework)
- 012.4-DEV-E2E-SCREENSHOTS (requires screenshot testing capability)
- 005.0-DEV-BUILD-VITE (requires production build system)

## Success Metrics

- **100% deployment readiness accuracy** - workflow correctly identifies deployment-ready code
- **Sub-10-minute validation** - deployment checks complete within 10 minutes
- **Zero deployment failures** - code passing this workflow deploys successfully
- **Visual consistency validation** - screenshots detect UI regressions
- **Clear deployment confidence** - developers know when code is deployment-ready
