# DEV-DEPLOY-SIMPLE: Simple GitHub Actions Vercel Deployment

## Release Goal

_"Release 0.5: Problem Validation - Enable reliable deployment with quality gates"_

Implement the simplest possible GitHub Actions controlled Vercel deployment following ADR-0029, providing quality gates, deployment via Vercel CLI, and basic rollback capabilities. This establishes the foundation for reliable deployments without over-engineering.

## How This Story Contributes

This story enables confident deployment of the voder.ai website by implementing essential quality gates and rollback capabilities. It provides the minimum viable deployment pipeline that prevents broken deployments while maintaining simplicity and following our architectural decisions.

## User Story

So that I can deploy changes confidently to production, as a developer, I want a GitHub Actions workflow that runs quality checks, deploys via Vercel CLI, validates the deployment, and automatically rolls back on failure.

**INVEST Criteria Compliance**:

- **Independent**: ✅ Can be implemented independently with existing tooling
- **Negotiable**: ✅ Quality checks and validation steps can be refined based on needs
- **Valuable**: ✅ Prevents broken deployments and enables reliable releases
- **Estimable**: ✅ Clear scope focused on basic deployment workflow. Estimated 1 sprint
- **Small**: ✅ APPROPRIATELY SIZED - Single deployment workflow with essential features
- **Testable**: ✅ Success measured by successful deployments, quality gate effectiveness, and rollback capability

## Acceptance Criteria

- [ ] **GitHub Actions Workflow**: `.github/workflows/deploy.yml` implements the deployment pipeline
- [ ] **Quality Gates**: Pre-deployment checks (lint, test, build) must pass before deployment
- [ ] **Vercel CLI Deployment**: Deploy using `vercel --prod` from GitHub Actions
- [ ] **Post-Deployment Validation**: Basic health check validates deployment success
- [ ] **Automatic Rollback**: Failed deployments trigger automatic rollback via `vercel rollback`
- [ ] **Deployment Triggers**: Workflow triggers on push to main branch only
- [ ] **Secure Token Management**: Vercel token stored as GitHub secret
- [ ] **Deployment Status**: Clear success/failure status reported in GitHub
- [ ] **Error Handling**: Graceful failure handling with informative error messages

## Requirements

### Deployment Pipeline Architecture

- **REQ-ADR-COMPLIANCE**: Implementation must follow [ADR-0029](../../docs/decisions/0029-use-github-actions-controlled-vercel-deployment.accepted.md)
- **REQ-QUALITY-GATES**: All existing quality checks must pass before deployment
- **REQ-VERCEL-CLI**: Use Vercel CLI for deployment control and rollback capabilities
- **REQ-MAIN-ONLY**: Deploy only from main branch to prevent accidental deployments
- **REQ-ATOMIC-DEPLOYMENT**: Entire deployment succeeds or fails as single unit

### Quality Gate Requirements

- **REQ-LINT-CHECK**: ESLint must pass with zero errors
- **REQ-TYPE-CHECK**: TypeScript compilation must succeed
- **REQ-UNIT-TESTS**: All unit tests must pass
- **REQ-BUILD-CHECK**: Production build must complete successfully
- **REQ-FORMAT-CHECK**: Prettier formatting must be consistent

### Deployment Process Requirements

- **REQ-CLI-DEPLOY**: Use `vercel --prod` for production deployment
- **REQ-DEPLOYMENT-META**: Include commit SHA and build metadata
- **REQ-WAIT-COMPLETION**: Wait for deployment completion before proceeding
- **REQ-DEPLOYMENT-URL**: Capture and validate deployment URL

### Validation and Rollback Requirements

- **REQ-HEALTH-CHECK**: Validate deployment with HTTP health check
- **REQ-SMOKE-TEST**: Basic functionality validation (homepage loads)
- **REQ-AUTO-ROLLBACK**: Automatic rollback on validation failure
- **REQ-ROLLBACK-SPEED**: Rollback must complete within 2 minutes
- **REQ-ERROR-NOTIFICATION**: Clear error reporting on deployment failure

### Security and Operational Requirements

- **REQ-SECRET-MANAGEMENT**: Vercel token stored as GitHub repository secret
- **REQ-MINIMAL-PERMISSIONS**: Use least-privilege access for deployment
- **REQ-AUDIT-TRAIL**: All deployment actions logged in GitHub Actions
- **REQ-MANUAL-OVERRIDE**: Ability to manually trigger deployment workflow

## Implementation Approach

### GitHub Actions Workflow Structure

```yaml
name: Deploy to Production
on:
  push:
    branches: [main]
  workflow_dispatch: # Manual trigger

jobs:
  quality-gates:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
      - name: Setup Node.js
      - name: Install dependencies
      - name: Run linting
      - name: Run type check
      - name: Run tests
      - name: Build production

  deploy:
    needs: quality-gates
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Vercel
      - name: Validate deployment
      - name: Rollback on failure
```

### Quality Gates Implementation

- **Linting**: `npm run lint:check` - Zero errors required
- **Type Check**: `npm run type-check` - TypeScript compilation
- **Testing**: `npm run test:ci` - All unit tests pass
- **Build**: `npm run build` - Production build succeeds
- **Format**: `npm run format:check` - Code formatting consistent

### Deployment Process

1. **Pre-deployment**: Quality gates must pass
2. **Deploy**: `vercel --prod --token $VERCEL_TOKEN`
3. **Capture URL**: Extract deployment URL from Vercel output
4. **Validate**: HTTP GET request to deployment URL (200 status)
5. **Smoke Test**: Validate critical page elements exist
6. **Rollback**: `vercel rollback --token $VERCEL_TOKEN` on failure

### Error Handling

- **Quality Gate Failure**: Stop deployment, report specific failure
- **Deployment Failure**: Report Vercel CLI error, no rollback needed
- **Validation Failure**: Automatic rollback, report validation error
- **Rollback Failure**: Report rollback error, require manual intervention

## Dependencies

- 005.0-DEV-BUILD-VITE (requires production build capability)
- 010.0-DEV-LINT-JS (requires linting for quality gates)
- 011.0-DEV-TEST-UNIT (requires unit testing for quality gates)
- 006.0-DEV-FORMAT (requires formatting checks for quality gates)
- [ADR-0029: GitHub Actions Controlled Vercel Deployment](../../docs/decisions/0029-use-github-actions-controlled-vercel-deployment.accepted.md)

## Success Criteria

### Functional Validation

- ✅ **Quality Gates**: Broken code cannot be deployed (lint/test/build failures prevent deployment)
- ✅ **Deployment Success**: Clean commits deploy successfully to production
- ✅ **Validation Works**: Health checks catch deployment issues
- ✅ **Rollback Functions**: Failed deployments automatically rollback within SLA

### Performance Metrics

- **Deployment Time**: Commit to live in production < 5 minutes
- **Rollback Time**: Failed deployment to rollback completion < 2 minutes
- **Success Rate**: > 95% of valid commits deploy successfully
- **False Positive Rate**: < 5% of deployments fail quality gates incorrectly

### Operational Validation

- **Zero Downtime**: No production outages from broken deployments
- **Clear Status**: Deployment status clearly visible in GitHub
- **Audit Trail**: All deployment activities logged and traceable
- **Manual Override**: Team can manually trigger deployments when needed

## Out of Scope

### Advanced Features (Future Stories)

- **Preview Deployments**: Branch-based preview deployments
- **Multi-Environment**: Staging environment deployment
- **Advanced Monitoring**: Performance monitoring, error tracking
- **Approval Workflows**: Manual approval gates for deployments
- **Deployment Notifications**: Slack/email notifications
- **Blue/Green Deployments**: Zero-downtime deployment strategies

### Complex Validation

- **E2E Testing**: End-to-end test validation (separate story)
- **Visual Regression**: Screenshot comparison validation
- **Performance Testing**: Load testing and performance validation
- **Security Scanning**: Advanced security vulnerability scanning

This story focuses on the essential deployment capabilities needed to safely and reliably deploy the voder.ai website following our architectural decisions, providing a solid foundation for future enhancements.