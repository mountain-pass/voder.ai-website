# 025.7-BIZ-LIGHT-CAUSTICS: Volumetric Light Caustics

## Release Goal

_"Release 1.0: MVP Problem Validation - Create sophisticated 3D visual experience that demonstrates technical capability and validates the AI slop problem message"_

This story enhances the glass cube's visual appeal by adding static volumetric light caustics within the cube interior, creating the organic, flowing light patterns that give the cube its distinctive sophisticated appearance and reinforce the "clarity emerging from chaos" metaphor central to the brand message.

## How This Story Contributes

This story transforms the glass cube from a simple transparent object into a visually captivating centerpiece by adding static volumetric caustics distributed throughout the cube's interior volume. These flowing light patterns create depth, sophistication, and visual interest while reinforcing the core metaphor of "bringing clarity to chaos" - the light patterns represent structure and intent emerging from complexity. The volumetric approach creates beautiful caustic-like effects visible through the glass surfaces while maintaining excellent performance. Starting with static patterns provides a clear baseline for visual validation before considering animation in future increments.

## User Story

So that I can be captivated by sophisticated visual design that reinforces the brand's "clarity from chaos" message through organic light patterns, as a business user (founder/VC), I want the glass cube to display static volumetric light caustics within its interior that create flowing, organic patterns visible through the transparent structure.

**INVEST Criteria Compliance**:

- **Independent**: Can be implemented independently as visual enhancement to existing cube
- **Negotiable**: Specific caustics technique and pattern intensity can be refined
- **Valuable**: Delivers distinctive visual signature that enhances brand perception and engagement
- **Estimable**: Clear scope for implementing static surface light effects in Three.js
- **Small**: Focused on adding static surface-based light patterns to existing cube geometry
- **Testable**: Visual regression tests can verify caustics rendering correctly with static patterns

## Acceptance Criteria

- [x] **Volumetric Light Caustics**: Flowing, organic light patterns visible throughout the glass cube's interior volume
- [x] **Caustics Effect**: Realistic volumetric light scattering patterns that create depth and definition
- [x] **Static Patterns**: Light patterns are static (non-animated) providing stable visual baseline
- [x] **Volume Integration**: Light patterns distributed throughout cube interior volume using raymarching
- [x] **Organic Quality**: Light patterns have organic, natural quality through ridge noise turbulence
- [x] **Performance**: Caustics rendering maintains 60fps on target devices
- [x] **Visual Consistency**: Light effects work cohesively with existing glass material (025.4)
- [x] **Cross-Browser Compatibility**: Caustics render correctly across modern browsers (WebGL2)
- [x] **Visual Regression Tests**: Screenshot tests verify caustics appearance matches target aesthetic

## Requirements

### Volumetric Light Caustics Implementation

- **REQ-CAUSTICS-TECHNIQUE**: Use WebGL2 volumetric raymarching with custom shaders for interior light effects
- **REQ-VOLUME-PATTERNS**: Create flowing, organic light patterns throughout cube interior volume
- **REQ-STATIC-RENDERING**: Light patterns are static (non-animated) for this increment
- **REQ-DEPTH-APPEARANCE**: Light patterns create sense of depth through volumetric distribution and transparency
- **REQ-NOISE-GENERATION**: Use ridge noise turbulence for organic caustic pattern generation
- **REQ-RAYMARCHING-QUALITY**: Implement multi-step raymarching with jittered sampling for quality

### Visual Quality Standards

- **REQ-ORGANIC-QUALITY**: Light patterns feel natural and organic through ridge noise turbulence
- **REQ-COLOR-HARMONY**: Light colors harmonize with dark glass material (subtle blue: 0x4488bb)
- **REQ-BRIGHTNESS-BALANCE**: Light intensity balanced for subtle, elegant appearance (density: 0.08)
- **REQ-VOLUME-SOFTNESS**: Volumetric patterns have soft, distributed appearance for elegance
- **REQ-PATTERN-COMPLEXITY**: Ridge noise with 4 octaves provides organic complexity without chaos

### Performance Requirements

- **REQ-PERF-60FPS**: Caustics rendering maintains 60fps on target devices
- **REQ-GPU-EFFICIENT**: Use GPU-accelerated techniques where possible
- **REQ-FALLBACK-STRATEGY**: Graceful degradation on lower-end devices if needed
- **REQ-RENDER-OPTIMIZATION**: Optimize shader complexity and texture resolution

### Integration Requirements

- **REQ-GLASS-INTEGRATION**: Volumetric caustics work cohesively with existing dark glass material (025.4)
- **REQ-TRANSPARENCY-INTEGRATION**: Caustics render correctly with transparency and depth sorting
- **REQ-ROTATION-INTEGRATION**: Volumetric patterns remain synchronized during scroll rotation (025.2)
- **REQ-VIEWPORT-INTEGRATION**: Caustics render correctly in viewport layout (025.5)
- **REQ-COORDINATE-SPACE**: Proper object-space coordinate transformation for accurate raymarching

### Accessibility and Safety

- **REQ-STATIC-SAFETY**: Static patterns eliminate seizure risks from animation or flashing
- **REQ-PERF-DEGRADATION**: Provide option to disable effects for performance/accessibility if needed

## Dependencies

- 025.0-BIZ-3D-ANIMATION (requires base cube geometry and Three.js setup)
- 025.4-BIZ-GLASS-MATERIAL (requires enhanced glass material to integrate with caustics)
- 025.5-BIZ-VIEWPORT-LAYOUT (requires viewport layout for proper rendering context)

## Implementation Notes

### Implementation Approach (Implemented)

**Volumetric Raymarching Technique** âœ… **IMPLEMENTED**

- WebGL2 volumetric raymarching with custom fragment shaders
- 40-step raymarching with jittered sampling for quality
- Object-space coordinate transformation via inverse(modelMatrix)
- Ridge noise turbulence (4 octaves) for organic patterns
- Additive blending with depthTest disabled for proper transparency
- Volume mesh (BoxGeometry 5.8x5.8x5.8) with renderOrder 999
- Pros: Highly performant (60fps), excellent visual quality, static patterns, organic appearance
- Cons: Requires WebGL2 support, shader complexity

### Alternative Approaches (Considered)

1. **Surface-based Shader Effects**
   - Custom fragment shader with noise functions applied to cube surfaces
   - Pros: Surface-specific control, potentially lower performance overhead
   - Cons: Less dramatic visual impact, harder to achieve volumetric depth

2. **Texture-based Light Maps**
   - Pre-rendered or procedural light streak textures mapped to surfaces
   - Pros: Art-directable, predictable results
   - Cons: Larger asset size, less dynamic, surface-only effects

3. **Emissive Material Layers**
   - Additional geometry layers with emissive materials creating patterns
   - Pros: Leverages Three.js built-in materials
   - Cons: More geometry overhead, surface-only effects

### Technical Implementation Details

- **WebGL2 Volumetric Raymarching**: Custom ShaderMaterial with vertex/fragment shaders
- **Coordinate Space**: Object-space raymarching using inverse(modelMatrix) transformation
- **Noise Generation**: Ridge turbulence (abs(noise \* 2.0 - 1.0)) with 4 octaves for organic patterns
- **Ray-Box Intersection**: Efficient algorithm for determining ray entry/exit points
- **Sampling Strategy**: 40-step raymarching with jittered sampling for quality anti-aliasing
- **Blending**: Additive blending (gl.ONE, gl.ONE) for proper light accumulation
- **Depth Handling**: depthTest: false, renderOrder: 999 for transparency rendering
- **Performance**: Optimized uniforms (density: 0.08, steps: 40) maintain 60fps
- **Rotation Sync**: Volume mesh synchronized with cube rotation for consistent appearance
- **Cross-browser**: WebGL2 required, graceful fallback to glass-only for unsupported browsers

### Visual Reference

Target appearance: Organic, flowing volumetric light patterns distributed throughout the interior of the glass cube, creating depth and visual interest. Light appears as subtle blue spots (0x4488bb) with organic distribution via ridge noise turbulence. Patterns are static (non-animated) for this increment, visible through the dark glass material, creating an elegant and sophisticated effect that reinforces the "clarity from chaos" metaphor.

Implemented appearance: Subtle blue light spots distributed throughout dark glass cube interior using WebGL2 volumetric raymarching with 4-octave ridge noise. Density: 0.08 for sparse elegance, emission: 2.0 for subtle intensity, 40-step raymarching maintains 60fps performance.

## Definition of Done

- [x] All acceptance criteria met
- [x] Code reviewed and approved
- [x] Visual regression tests passing with caustics visible
- [x] Performance tests confirm 60fps maintenance
- [x] Cross-browser testing completed (WebGL2 required)
- [x] Static patterns verified in visual regression tests
- [x] Documentation updated with volumetric caustics implementation details
- [x] Deployed and visually verified in production environment
- [ ] Future animation story (025.8) can be considered based on volumetric baseline success
